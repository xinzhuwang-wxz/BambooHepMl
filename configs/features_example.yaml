# 特征配置文件示例
# 
# 定义 event-level 和 object-level 特征
# 支持特征表达式、标准化、裁剪、填充等处理

features:
  # Event-level 特征（每个事件一个值）
  event_level:
    # 简单特征：直接使用原始字段
    - name: met
      source: met
      type: event
      dtype: float32

    # 带表达式的特征：使用表达式计算
    - name: met_log
      source: met
      type: event
      dtype: float32
      expr: log1p(met)  # 计算 log(1 + met)
      normalize:
        method: auto  # 自动标准化（计算均值和标准差）
      clip:
        min: 0.0
        max: 10.0

    # 聚合特征：从 object-level 数据聚合
    - name: nJets
      source: Jet
      type: event
      dtype: int32
      expr: len(Jet)  # 计算 jet 数量

    - name: ht
      source: Jet
      type: event
      dtype: float32
      expr: sum(Jet.pt)  # 计算所有 jet 的 pt 之和
      normalize:
        method: auto

    # 更多 event-level 特征示例
    # - name: met_phi
    #   source: met_phi
    #   type: event
    #   dtype: float32
    #   normalize:
    #     method: auto

  # Object-level 特征（每个对象一个值，如每个 jet）
  object_level:
    # 示例 1: vector<float> 类型的变量（直接使用变量名）
    # 假设 ROOT 文件中有 vector<float> my_vector
    - name: my_vector
      source: my_vector  # source 和 name 都写变量名
      type: object
      dtype: float32
      normalize:
        method: auto
      padding:
        max_length: 100  # 最大元素数量
        mode: constant
        value: 0.0

    # 示例 2: vector<float> 的 log 变换（对每个元素都加 log）
    - name: my_vector_log
      source: my_vector  # 源变量名
      type: object
      dtype: float32
      expr: log1p(my_vector)  # 对每个事件中的每个元素都计算 log1p
      normalize:
        method: auto
      padding:
        max_length: 100
        mode: constant
        value: 0.0

    # Jet 的 pt
    - name: jet_pt
      source: Jet.pt
      type: object
      dtype: float32
      normalize:
        method: auto
      padding:
        max_length: 50  # 最大 jet 数量
        mode: constant   # 填充模式：constant, zero, mean
        value: 0.0       # 填充值（constant 模式）

    # Jet 的 eta
    - name: jet_eta
      source: Jet.eta
      type: object
      dtype: float32
      normalize:
        method: auto
      padding:
        max_length: 50
        mode: constant
        value: 0.0

    # Jet 的 phi
    - name: jet_phi
      source: Jet.phi
      type: object
      dtype: float32
      normalize:
        method: auto
      padding:
        max_length: 50
        mode: constant
        value: 0.0

    # Jet 的 mass
    - name: jet_mass
      source: Jet.mass
      type: object
      dtype: float32
      normalize:
        method: auto
      padding:
        max_length: 50
        mode: constant
        value: 0.0

    # 带表达式的 object-level 特征示例
    # - name: jet_pt_log
    #   source: Jet.pt
    #   type: object
    #   dtype: float32
    #   expr: log1p(Jet.pt)  # 对每个 jet 的 pt 计算 log1p
    #   normalize:
    #     method: auto
    #   padding:
    #     max_length: 50
    #     mode: constant
    #     value: 0.0

# 配置说明：
# - name: 特征名称（唯一标识符）
# - source: 数据源字段名（ROOT/Parquet 中的分支名）
#   * 对于 vector<float> 类型：source 和 name 都写变量名，如 source: my_vector
#   * 对于结构体字段：使用点号，如 source: Jet.pt
# - type: 特征类型，"event" 或 "object"
#   * "event": 每个事件一个值（标量）
#   * "object": 每个事件有多个值（vector/array），如 vector<float>、Jet 集合等
# - dtype: 数据类型（float32, int32, int64 等）
# - expr: 可选的表达式（使用 ExpressionEngine 支持的函数）
#   * 对于 object-level 特征，表达式会对每个事件中的每个元素都应用
#   * 例如：expr: log1p(my_vector) 会对每个元素计算 log1p
# - normalize: 标准化配置
#   - method: "auto"（自动计算均值和标准差）或 "manual"（手动指定 center 和 scale）
#   - center: 手动指定的中心值（可选）
#   - scale: 手动指定的缩放值（可选）
# - clip: 裁剪配置（限制值范围）
#   - min: 最小值
#   - max: 最大值
# - padding: 填充配置（仅 object-level 特征，必需）
#   - max_length: 最大对象/元素数量（需要根据数据设置）
#   - mode: 填充模式（constant, zero, mean）
#   - value: 填充值（constant 模式使用）
#
# vector<float> 类型配置示例：
#   - name: my_vector
#     source: my_vector  # source 和 name 都写变量名
#     type: object       # vector 类型必须是 object
#     dtype: float32
#     padding:
#       max_length: 100  # 根据实际数据设置最大长度
#       mode: constant
#       value: 0.0

